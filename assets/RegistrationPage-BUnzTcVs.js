import{j as e,r as o}from"./index-CxcwRaQr.js";function y({data:s,setData:r}){return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Как тебя зовут?"}),e.jsx("input",{type:"text",value:s.name,onChange:n=>r({...s,name:n.target.value}),placeholder:"Имя",className:"input"})]})}function w({data:s,setData:r}){return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Сколько тебе лет?"}),e.jsx("input",{type:"number",min:13,value:s.age??"",onChange:n=>r({...s,age:Number(n.target.value)}),placeholder:"Возраст",className:"input"})]})}const S=({data:s,setData:r})=>{const n=[{value:"male",label:"Мужской"},{value:"female",label:"Женский"},{value:"other",label:"Другое"}];return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Твой гендер"}),e.jsx("div",{className:"radio-group",children:n.map(t=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"gender",value:t.value,checked:s.gender===t.value,onChange:()=>r({...s,gender:t.value})}),t.label]},t.value))})]})},C=({data:s,setData:r})=>{const n=[{value:"male",label:"Только мужчин"},{value:"female",label:"Только женщин"},{value:"mix",label:"Всех (микс)"}];return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Кого показывать в рекомендациях?"}),e.jsx("div",{className:"options",children:n.map(t=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"showGender",value:t.value,checked:s.showGender===t.value,onChange:()=>r({...s,showGender:t.value})}),t.label]},t.value))})]})},j=["London","Manchester","Birmingham","Liverpool","Leeds","Glasgow","Edinburgh","Bristol","Nottingham","Sheffield"];function k({data:s,setData:r}){const[n,t]=o.useState(""),[i,l]=o.useState([]),[c,p]=o.useState(!1);return o.useEffect(()=>{if(c){l([]);return}if(n.length<2){l([]);return}let a=!1;async function d(){try{const g=`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&country=United%20Kingdom&city=${encodeURIComponent(n)}`,h=await fetch(g,{headers:{"Accept-Language":"en","User-Agent":"NiraApp/1.0"}});if(!h.ok)throw new Error("API error");const v=await h.json();if(a)return;const N=v.map(u=>u.address.city||u.address.town||u.address.village).filter(Boolean),x=Array.from(new Set(N));if(x.length===0){const u=j.filter(b=>b.toLowerCase().includes(n.toLowerCase()));l(u)}else l(x)}catch{if(!a){const g=j.filter(h=>h.toLowerCase().includes(n.toLowerCase()));l(g)}}}const f=setTimeout(d,300);return()=>{a=!0,clearTimeout(f)}},[n,c]),e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Город"}),e.jsx("input",{type:"text",value:n,onChange:a=>{t(a.target.value),r({...s,city:a.target.value})},placeholder:"Город",className:"input",disabled:c}),e.jsxs("label",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:c,onChange:a=>{const d=a.target.checked;p(d),d&&(t(""),l([]),r({...s,city:""}))}}),"Живу не в UK"]}),!c&&i.length>0&&e.jsx("div",{className:"autocomplete",children:i.map(a=>e.jsx("div",{className:"option",onClick:()=>{t(a),r({...s,city:a})},children:a},a))})]})}function _({data:s,setData:r}){return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Рост и вес"}),e.jsx("input",{type:"number",placeholder:"Рост (см)",value:s.height??"",onChange:n=>r({...s,height:Number(n.target.value)}),className:"input"}),e.jsx("input",{type:"number",placeholder:"Вес (кг)",value:s.weight??"",onChange:n=>r({...s,weight:Number(n.target.value)}),className:"input"})]})}const T=["Спорт","Музыка","Книги","Путешествия","Игры","Кино"];function I({data:s,setData:r}){const n=t=>{s.goal.includes(t)?r({...s,goal:s.goal.filter(i=>i!==t)}):r({...s,goal:[...s.goal,t]})};return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Интересы"}),e.jsx("div",{className:"interests",children:T.map(t=>e.jsx("button",{className:s.goal.includes(t)?"interest selected":"interest",onClick:()=>n(t),children:t},t))})]})}function A({data:s,setData:r}){return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"О себе"}),e.jsx("textarea",{value:s.description||"",onChange:n=>r({...s,description:n.target.value}),placeholder:"Расскажи немного о себе",className:"textarea",rows:4})]})}const E="http://localhost:8000";function L({data:s}){const r=async()=>{try{if(!(await fetch(`${E}/api/create/user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Ошибка сохранения");alert("Данные успешно сохранены!")}catch(n){console.error(n),alert("Не удалось сохранить данные. Попробуй еще раз.")}};return e.jsxs("div",{className:"step",children:[e.jsx("h2",{children:"Проверь свои данные"}),e.jsx("pre",{children:JSON.stringify(s,null,2)}),e.jsx("button",{onClick:r,className:"btn-save",children:"Сохранить"})]})}const U="_container_1ddk7_1",B="_progressBar_1ddk7_19",G="_progress_1ddk7_19",m={container:U,progressBar:B,progress:G},R={name:"",age:-1,gender:null,showGender:null,city:"",current_country:null,height:null,weight:null,goal:[],description:"",tg_id:-1};function O(){const[s,r]=o.useState(0),[n,t]=o.useState(null),[i,l]=o.useState(R);o.useEffect(()=>{window.Telegram?.WebApp?.initDataUnsafe&&t(Number(window.Telegram.WebApp.initDataUnsafe.user?.id))},[]),o.useEffect(()=>{n&&l(a=>({...a,tg_id:n}))},[n]);const c=[e.jsx(y,{data:i,setData:l}),e.jsx(w,{data:i,setData:l}),e.jsx(S,{data:i,setData:l}),e.jsx(C,{data:i,setData:l}),e.jsx(k,{data:i,setData:l}),e.jsx(_,{data:i,setData:l}),e.jsx(I,{data:i,setData:l}),e.jsx(A,{data:i,setData:l}),e.jsx(L,{data:i})],p=Math.round((s+1)/c.length*100);return e.jsxs("div",{className:m.container,children:[e.jsx("div",{className:m.progressBar,children:e.jsx("div",{className:m.progress,style:{width:`${p}%`}})}),c[s],e.jsx("button",{onClick:()=>r(s-1),style:{marginTop:"16px"},children:"Назад"}),e.jsx("button",{onClick:()=>r(s+1),style:{marginTop:"16px"},children:"Далее"})]})}export{O as default};
